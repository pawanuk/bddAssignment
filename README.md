# Betfair Automation Framework

## Overview

This automation framework is designed to automate the testing of the Betfair web application using Playwright, Cucumber, and TypeScript. The framework follows the principles of Behavior-Driven Development (BDD) and uses the Page Object Model (POM) for organizing test scripts.

## Features

- **BDD with Cucumber:** Write test cases in Gherkin syntax for clear, understandable scenarios.
- **Playwright Integration:** Automate browser interactions using Playwright's powerful API.
- **TypeScript Support:** Type-safe scripting with TypeScript to catch errors early during development.
- **Page Object Model:** Organized code structure with reusable page components.
- **Parallel Execution:** Run multiple test scenarios in parallel to reduce execution time.
- **Comprehensive Reporting:** Generate HTML and JSON reports for test results.

## Project Structure

```plaintext
.
├── README.md                         # Documentation for the project setup, usage, and guidelines.
├── auth.json                         # Configuration file for authentication credentials or tokens.
├── cleanup.js                        # Script to clean up environment or data post-test execution.
├── cucumber.json                     # Configuration file for Cucumber, defining test settings and options.
├── generateReport.js                 # Script to generate test reports from raw data.
├── package-lock.json                 # Auto-generated file for locking dependencies to specific versions.
├── package.json                      # Node.js project file listing dependencies, scripts, and project metadata.
├── playwright.config.ts              # Configuration file for Playwright, specifying browser settings, test timeout, etc.
├── reports                           # Directory containing generated test reports.
│   ├── cucumber-html-report.html     # HTML formatted report generated by Cucumber.
│   ├── cucumber-report.html          # Additional HTML report, potentially customized.
│   └── cucumber-report.json          # JSON formatted report with detailed test results.
├── run-tests-sequentially.js         # Script to execute tests in a sequential order.
├── screenshots                       # Directory for storing screenshots captured during test runs.
├── src                               # Source directory for application code and tests.
│   ├── pages                         # Page Object Model (POM) classes defining page interactions.
│   │   ├── BasePage.ts               # Base class for shared page methods and properties.
│   │   ├── LoginPage.ts              # Page class for login functionalities.
│   │   └── PoliticsPage.ts           # Page class for functionalities related to the politics section.
│   ├── test                          # Directory for test definitions and configurations.
│   │   ├── features                  # Gherkin feature files defining test scenarios.
│   │   │   └── place_bets.feature    # Example feature file for placing bets.
│   │   ├── hooks.ts                  # Hooks for test setup and teardown, like before and after scenarios.
│   │   ├── steps                     # Step definitions mapping Gherkin steps to code.
│   │   │   └── place_bets_steps.ts   # Step definitions for the place_bets.feature.
│   │   └── world.ts                  # Custom world object for sharing context between steps in Cucumber.
│   ├── test-data                     # Directory for storing test data files.
│   │   └── betData.json              # JSON file containing data for betting test cases.
│   ├── types                         # TypeScript types and interfaces used across the project.
│   │   └── BetResult.ts              # Type definition for the BetResult data structure.
│   └── utils                         # Utility functions and helper classes.
│       ├── env.ts                    # Environment configuration and management utilities.
│       └── testHelpers.ts            # Helper functions for use in tests.
├── test-runs.log                     # Log file capturing details of test executions.
├── tsconfig.json                     # TypeScript configuration file specifying compiler options.
└── videos                            # Directory for storing video recordings of test runs.
```

## Page Objects

- **BasePage.ts:** Contains common methods like goto, click, fillInputField, and isElementVisible. All other pages inherit from this class.
- **LoginPage.ts:** Handles actions related to logging into the Betfair application, such as filling in the username and password fields and clicking the login button.
- **PoliticsPage.ts:** Manages interactions within the Politics section of the Betfair site, such as placing bets, verifying bet results, and logging out.

## Test Features and Steps

- **place_bets.feature:** Defines scenarios for placing bets on various candidates. Each scenario is written in Gherkin syntax.
- **edge_cases.feature:** Defines scenarios to test various edge cases, such as entering non-numeric values or exceeding account balance.
- **place_bets_steps.ts:** Implements the steps defined in place_bets.feature using TypeScript. This includes logging in, navigating to the Politics section, placing bets, and verifying results.
- **edge_cases_steps.ts:** Implements the steps defined in edge_cases.feature using TypeScript. Handles testing for edge cases like invalid inputs.

## Utilities

- **env.ts:** Stores environment variables such as URLs, usernames, passwords, and timeouts.
- **helpers.ts:** Contains utility functions for tasks like cleaning directories, taking screenshots on failure, and closing browser contexts.

## Types

- **BetResult.ts:** Defines TypeScript types and interfaces related to betting results, ensuring strong type checking throughout the test scripts.

## Setup and Installation

### Prerequisites

- Node.js (v14 or higher)
- npm or yarn
- Playwright: Playwright will be installed automatically with the project dependencies.

### Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/your-repo/betfair-automation.git
   cd betfair-automation
   ```

2. Install dependencies:
   ```bash
   npm install
   ```

3. Install Playwright browsers:
   ```bash
   npx playwright install
   ```
4. npm install @types/fs-extra --save-dev
   npm install dotenv   

### Environment Configuration

Configure the environment variables by creating an `.env` file in the root directory. Example:

```env
BETFAIR_URL=https://www.betfair.com
BETFAIR_USERNAME=your_username
BETFAIR_PASSWORD=your_password
PAGE_LOAD_TIMEOUT=10000
INPUT_DELAY=3000
ELEMENT_TIMEOUT=60000
```

## Running Tests

- Run All Tests:
  ```bash
  npm run test
  ```

- Run Specific Feature:
  ```bash
  npx cucumber-js src/test/features/place_bets.feature
  ```

- Generate HTML Report:
  ```bash
  npm run test
  ```
  The HTML report will be generated in the `reports/` directory.

## Parallel Execution

To run tests in parallel, ensure the `"parallel": 5` setting in the `cucumber.json` file is configured. This will run up to 5 scenarios simultaneously.

## Debugging

- View Test Run Video: Videos of the test runs are stored in the `videos/` directory.
- View Screenshots: Screenshots are stored in the `screenshots/` directory for both successes and failures.

## Best Practices

1. Use Page Objects: Ensure all page-specific actions are encapsulated in Page Object classes.
2. Avoid Hardcoding: Use environment variables and centralized locators to avoid hardcoded values.
3. Write Reusable Steps: Make step definitions as reusable as possible by using parameters.
4. Error Handling: Implement robust error handling to make debugging easier.
5. Keep Feature Files Clean: Focus on high-level actions and business logic in feature files. Leave implementation details to step definitions.

## Future Enhancements

1. CI/CD Integration: Set up continuous integration to automatically run tests on each push.
2. Data-Driven Testing: Externalize test data to JSON or CSV files for more flexible test scenarios.
3. Enhanced Reporting: Integrate with tools like Allure for more detailed test reports.

## Conclusion

This automation framework provides a robust foundation for testing the Betfair web application. With proper setup and adherence to best practices, it can be extended and scaled to cover a wide range of test scenarios.